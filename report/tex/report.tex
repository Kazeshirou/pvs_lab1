\documentclass[a4paper,12pt]{article}

\input{header.tex}

\title{Отчёт по лабораторной работе \\ <<IP-маршрутизация>>}
\author{Жарова~Н.~А.}

\begin{document}

\maketitle

\tableofcontents

% Текст отчёта должен быть читаемым!!! Написанное здесь является рыбой.

\section{Топология сети}

Топология сети и использыемые IP-адреса показаны на рис.~\ref{fig:network}.

\begin{figure}
\centering
\includegraphics[width=\textwidth]{includes/network_gv.pdf}
\caption{Топология сети}
\label{fig:network}
\end{figure}


\section{Назначение IP-адресов}

Ниже приведён файл настройки протокола IP маршрутизатора \textbf{r1}.

\begin{Verbatim}
auto lo
iface lo inet loopback

auto eth0
iface eth0 inet static
address 10.0.10.1
netmask 255.255.255.0
up ip r add 10.0.20.0/24 via 10.0.10.2 dev eth0; ip r add 10.0.30.0/24 via 10.0.10.2 dev eth0
down ip r del 10.0.20.0/24; ip r del 10.0.30.0/24

auto eth1
iface eth1 inet static
address 10.0.40.1
netmask 255.255.255.0
up ip r add 10.0.50.0/24 via 10.0.40.2 dev eth1
down ip r del 10.0.50.0/24
\end{Verbatim}

Ниже приведён файл настройки протокола IP маршрутизатора \textbf{r2}.

\begin{Verbatim}
auto lo
iface lo inet loopback

auto eth0
iface eth0 inet static
address 10.0.10.2
netmask 255.255.255.0
up ip r add 10.0.40.0/24 via 10.0.10.1 dev eth0
down ip r del 10.0.40.0/24

auto eth1
iface eth1 inet static
address 10.0.30.1
netmask 255.255.255.0
up ip r add 10.0.50.0/24 via 10.0.30.2 dev eth1
down ip r del 10.0.50.0/24

auto eth2
iface eth2 inet static
address 10.0.20.1
netmask 255.255.255.0
\end{Verbatim}

Ниже приведён файл настройки протокола IP маршрутизатора \textbf{r3}.

\begin{Verbatim}
auto lo
iface lo inet loopback

auto eth0
iface eth0 inet static
address 10.0.30.2
netmask 255.255.255.0
up ip r add 10.0.20.0/24 via 10.0.30.1 dev eth0
down ip r del 10.0.20.0/24

auto eth1
iface eth1 inet static
address 10.0.40.2
netmask 255.255.255.0
up ip r add 10.0.10.0/24 via 10.0.40.1 dev eth1
down ip r del 10.0.10.0/24

auto eth2
iface eth2 inet static
address 10.0.50.1
netmask 255.255.255.0
\end{Verbatim}

Ниже приведён файл настройки протокола IP рабочей станции \textbf{ws1}.

\begin{Verbatim}
auto lo
iface lo inet loopback

auto eth0
iface eth0 inet static
address 10.0.20.2
netmask 255.255.255.0
gateway 10.0.20.1
\end{Verbatim}

Ниже приведён файл настройки протокола IP рабочей станции \textbf{ws2}.

\begin{Verbatim}
auto lo
iface lo inet loopback

auto eth0
iface eth0 inet static
address 10.0.50.2
netmask 255.255.255.0
gateway 10.0.50.1
\end{Verbatim}

\section{Таблица маршрутизации}

Вывод (\textit{ip r}) таблицы маршрутизации для \textbf{r1}.

\begin{Verbatim}
10.0.20.0/24 via 10.0.10.2 dev eth0 
10.0.50.0/24 via 10.0.40.2 dev eth1 
10.0.30.0/24 via 10.0.10.2 dev eth0 
10.0.40.0/24 dev eth1  proto kernel  scope link  src 10.0.40.1 
10.0.10.0/24 dev eth0  proto kernel  scope link  src 10.0.10.1 
\end{Verbatim}


Вывод (\textit{ip r}) таблицы маршрутизации для \textbf{r2}.

\begin{Verbatim}
10.0.20.0/24 dev eth2  proto kernel  scope link  src 10.0.20.1 
10.0.50.0/24 via 10.0.30.2 dev eth1 
10.0.30.0/24 dev eth1  proto kernel  scope link  src 10.0.30.1 
10.0.40.0/24 via 10.0.10.1 dev eth0 
10.0.10.0/24 dev eth0  proto kernel  scope link  src 10.0.10.2
\end{Verbatim}

Вывод (\textit{ip r}) таблицы маршрутизации для \textbf{r3}.

\begin{Verbatim}
10.0.20.0/24 via 10.0.30.1 dev eth0 
10.0.50.0/24 dev eth2  proto kernel  scope link  src 10.0.50.1 
10.0.30.0/24 dev eth0  proto kernel  scope link  src 10.0.30.2 
10.0.40.0/24 dev eth1  proto kernel  scope link  src 10.0.40.2 
10.0.10.0/24 via 10.0.40.1 dev eth1 
\end{Verbatim}

Вывод (\textit{ip r}) таблицы маршрутизации для \textbf{ws1}.

\begin{Verbatim}
10.0.20.0/24 dev eth0  proto kernel  scope link  src 10.0.20.2 
default via 10.0.20.1 dev eth0 
\end{Verbatim}

Вывод (\textit{ip r}) таблицы маршрутизации для \textbf{ws2}.

\begin{Verbatim}
10.0.50.0/24 dev eth0  proto kernel  scope link  src 10.0.50.2 
default via 10.0.50.1 dev eth0 
\end{Verbatim}

\section{Проверка настройки сети}

Вывод \textbf{traceroute} от узла ws2 до ws1 при нормальной работе сети.

\begin{Verbatim}
traceroute to 10.0.20.2 (10.0.20.2), 64 hops max, 40 byte packets
1  10.0.50.1 (10.0.50.1)  2 ms  1 ms  1 ms
2  10.0.30.1 (10.0.30.1)  5 ms  1 ms  1 ms
3  10.0.20.2 (10.0.20.2)  12 ms  1 ms  1 ms
\end{Verbatim}

Вывод \textbf{traceroute} от узла ws1 до r1 (eth1) при нормальной работе сети.

\begin{Verbatim}
traceroute to 10.0.40.1 (10.0.40.1), 64 hops max, 40 byte packets
1  10.0.20.1 (10.0.20.1)  1 ms  1 ms  0 ms
2  10.0.40.1 (10.0.40.1)  7 ms  1 ms  1 ms
\end{Verbatim}

Вывод \textbf{traceroute} от узла ws2 до r1 (eth0) при нормальной работе сети.

\begin{Verbatim}
traceroute to 10.0.10.1 (10.0.10.1), 64 hops max, 40 byte packets
1  10.0.50.1 (10.0.50.1)  1 ms  1 ms  0 ms
2  10.0.10.1 (10.0.10.1)  11 ms  1 ms  1 ms
\end{Verbatim}


\section{Маршрутизация}

% На пути здесь достаточно быть одному аршрутизатору!

Вначале стоит написать, какие MAC-адреса интерфейсов в опыте были у каких машин.
Затем вывести маршрутную таблицу маршрутизатора (вывод команды ip r!)

\begin{Verbatim}
маршрутная таблица маршрутизатора
\end{Verbatim}

Показаны опыты после стирания кеша ARP.
% Не забудьте это сделать!
Далее показана отправка пакета на маршрутизатор (косвенная маршрутизация). 

\begin{Verbatim}
Тут должен быть виден arp и затем посылка пакета маршрутизатору. 
С мак-адресами.
\end{Verbatim}

Затем маршрутизатор отправил его далее.

\begin{Verbatim}
Тут должен быть виден arp и затем посылка пакета маршрутизатором конечному получателю. 
С мак-адресами.
\end{Verbatim}

\section{Продолжительность жизни пакета}

Сначала написать как и на чём ломали. 

\begin{Verbatim}
Команды ломания
\end{Verbatim}

Потом какая-то таблица вышла.

\begin{Verbatim}
Испорченная таблица маршрутизации
\end{Verbatim}

Потом что слали.

\begin{Verbatim}
Команда посылки
\end{Verbatim}

И что в итоге получилось.

\begin{Verbatim}
Чуть сокращеннный лог, с мак адресами
\end{Verbatim}

И кто в итоге отравил сообщение о завершении жизни.

\section{Изучение IP-фрагментации}

Написать, на каких узлах и как изменяли MTU.


\begin{Verbatim}
Изменение MTU
\end{Verbatim}

\begin{Verbatim}
Изменение MTU
\end{Verbatim}

% Напоминаем, что PMTU следует отключить!

Какие команды давали для тестирования и где.

\begin{Verbatim}
Здесь вписать команду
\end{Verbatim}

Вывод \textbf{tcpdump} на маршрутизаторе перед сетью с уменьшенным MTU.

% Вывод в ширину можно и сократить, удалив несущественные моменты!

\begin{Verbatim}
Здесь вывод tcpdump, мак адреса не нужны.
\end{Verbatim}

Вывод \textbf{tcpdump} на маршрутизаторе после сети с уменьшенным MTU.

% Вывод в ширину можно и сократить, удалив несущественные моменты!

\begin{Verbatim}
Здесь вывод tcpdump, мак адреса не нужны.
\end{Verbatim}


Вывод \textbf{tcpdump} на узле получателя.

\begin{Verbatim}
Здесь вывод tcpdump, мак адреса не нужны.
\end{Verbatim}


\section{Отсутствие сети}

Аналогично опишите опыт, когда маршрутизатор отсылает сообщение об отстутствии с сети.
С командами и выводом, мак адреса не нужны.


\section{Отсутствие IP-адреса в сети}

Аналогично опишите опыт, когда маршрутизатор отсылает сообщение об отстутствии требуемого IP-адреса в сети.
С командами и выводом, мак адреса не нужны.

\end{document}
